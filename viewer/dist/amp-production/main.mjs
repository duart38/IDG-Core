let e=(e,t,r,n,s)=>{const o=s.executorsAllowed.includes(8);return{execute:(e,n,s)=>(o&&s&&(e=t.getNode(e[n+1]))&&(s=e.transferControlToOffscreen(),r.messageToWorker({12:9,13:[e._index_],38:s},[s])),n+2)}},t=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],r=(e,t)=>Array.prototype.forEach.call(e,t);class n{constructor(e,t){this.nodes=this.count=this.stringContext=this.baseElement=void 0,this.createNodes=(e,t)=>{let r=(e=new Uint16Array(e)).length;for(let s=0;s<r;s+=5){var n=void 0;if(3===e[s+1])n=document.createTextNode(this.stringContext.get(e[s+3]));else if(8===e[s+1])n=document.createComment(this.stringContext.get(e[s+3]));else if(11===e[s+1])n=document.createDocumentFragment();else if(n=this.stringContext.get(e[s+2]),n=0!==e[s+4]?document.createElementNS(this.stringContext.get(e[s+4]),n):document.createElement(n),t&&!t.sanitize(n))continue;this.storeNode(n,e[s])}},this.getNode=e=>(e=this.nodes.get(e))&&"BODY"===e.nodeName?this.baseElement:e,this.storeNodes=e=>{this.storeNode(e,++this.count),r(e.childNodes,(e=>this.storeNodes(e)))},this.count=2,this.stringContext=e,this.nodes=new Map([[1,t],[2,t]]),this.baseElement=t,t._index_=2,r(t.childNodes,(e=>this.storeNodes(e)))}storeNode(e,t){e._index_=t,this.nodes.set(t,e)}}let s=new Map,o=(e,t)=>{t&&"value"in t&&null===t.oninput&&(t.oninput=()=>a(e,t))},i=(e,t)=>{t&&"value"in t&&!s.get(t)&&(new MutationObserver((t=>t.map((t=>a(e,t.target))))).observe(t,{attributes:!0}),s.set(t,!0))},a=(e,t)=>e.messageToWorker({12:4,40:{7:t._index_,21:t.value}}),l=e=>Object.values(e).map((e=>[e.identifier,e.screenX,e.screenY,e.clientX,e.clientY,e.pageX,e.pageY,e.target._index_])),u=(e,t,r,n,s)=>{const u=[],c=s.executorsAllowed.includes(4);let d=[window.innerWidth,window.innerHeight];const h=(e,t)=>n=>{t&&n.preventDefault();var s=n.currentTarget;if(s&&"value"in s)a(r,n.currentTarget);else if("resize"===n.type){const{innerWidth:e,innerHeight:t}=window;if(d[0]===e&&d[1]===t)return;d=[window.innerWidth,window.innerHeight],r.messageToWorker({12:5,40:d})}r.messageToWorker({12:1,39:{7:e,25:n.bubbles,26:n.cancelable,27:n.cancelBubble,28:[n.currentTarget._index_||0],29:n.defaultPrevented,30:n.eventPhase,31:n.isTrusted,32:n.returnValue,13:[n.target._index_||0],33:n.timeStamp,12:n.type,35:"keyCode"in n?n.keyCode:void 0,60:"pageX"in n?n.pageX:void 0,61:"pageY"in n?n.pageY:void 0,65:"offsetX"in n?n.offsetX:void 0,66:"offsetY"in n?n.offsetY:void 0,62:"touches"in n?l(n.touches):void 0,63:"changedTouches"in n?l(n.changedTouches):void 0}})};return{execute(n,s,a){var l=n[s+2];const d=s+4+2*l;if(l=s+4+6*n[s+3]+2*l,c&&a&&(a=t.getNode(n[s+1]))){let c=s+4;for(;c<l;){const l=c<=d;e:{s=a;var g=l,m=n,f=c;const d=e.get(m[f]),p=m[f+1];if(s===t.baseElement){g?addEventListener(d,u[p]=h(1,!!m[f+5])):removeEventListener(d,u[p]);break e}let w=null!==s.oninput;const x="change"===d;g?(x&&(w=!0,s.onchange=null),s.addEventListener(d,u[p]=h(s._index_,!!m[f+5]))):(x&&(w=!1),s.removeEventListener(d,u[p])),s&&"value"in s&&(w||o(r,s),i(r,s))}c+=l?2:6}}return l}}},c=(e,t,r,n,s)=>{const o=s.executorsAllowed.includes(5);return{execute:(e,n,s)=>(o&&s&&(e=t.getNode(e[n+1]))&&(s=e.getBoundingClientRect(),r.messageToWorker({12:6,13:[e._index_],38:[s.top,s.right,s.bottom,s.left,s.width,s.height]})),n+2)}},d=(e,{getNode:t},r,n,s)=>{const a=s.executorsAllowed.includes(2);return{execute(e,n,s){const l=e[n+4],u=e[n+5];if(a&&s){const s=t(e[n+1]);s&&(0<u&&e.slice(n+6+l,n+6+l+u).forEach((e=>{(e=t(e))&&e.remove()})),0<l&&e.slice(n+6,n+6+l).forEach((a=>{const l=e[n+2];(a=t(a))&&(s.insertBefore(a,l&&t(l)||null),o(r,a),i(r,a))})))}return n+6+l+u}}},h=(e,t,r,n,s)=>{const o=s.executorsAllowed.includes(0);return{execute(r,n,i){if(o&&i){i=t.getNode(r[n+1]);const o=e.get(r[n+2]);r=0!==(r=r[n+4])?e.get(r-1):null,i&&null!=o&&(s.sanitizer?s.sanitizer.setAttribute(i,o,r):null==r?i.removeAttribute(o):i.setAttribute(o,r))}return n+5}}},g=(e,t,r,n,s)=>{const o=s.executorsAllowed.includes(1);return{execute:(r,n,s)=>(o&&s&&(s=t.getNode(r[n+1]),r=r[n+2],s&&r&&(s.textContent=e.get(r))),n+3)}},m=(e,t,r,n,s)=>{const o=s.executorsAllowed.includes(3);return{execute(r,n,i){if(o&&i){i=t.getNode(r[n+1]);const o=e.get(r[n+2]);{const t=r[n+4];r=1===r[n+3]?1===t:0!==t?e.get(t):null}i&&o&&null!=r&&(s.sanitizer?s.sanitizer.setProperty(i,o,String(r)):i[o]=r)}return n+5}}},f=(e,t,r,n,s)=>{const o=s.executorsAllowed.includes(6);let i,a=0;return{execute(e,t,r){if(o&&r&&s.longTask)if(6===e[t]){if(a++,!i){const e=new Promise((e=>i=e));Promise.resolve().then((()=>s.longTask&&s.longTask(e)))}}else 7===e[t]&&(a--,i&&0>=a&&(i(),i=null,a=0));return t+2},get active(){return null!==i}}},p=new Float32Array(1),w=new Uint16Array(p.buffer);function x(e,t,r,n,s,o){let i=[];for(let l=0;l<r;l++)switch(e[t++]){case 1:i.push(e[t++]);break;case 2:w[0]=e[t++],w[1]=e[t++],i.push(p[0]);break;case 3:i.push(n.get(e[t++]));break;case 4:var a=e[t++];t=x(e,t,a,n,s,o),i.push(t.args),t=t.offset;break;case 5:if(!o)throw Error("objectContext not provided.");i.push(o.get(e[t++]));break;case 6:a=s.getNode(e[t++]),i.push(a.getContext("2d"));break;case 7:i.push(s.getNode(e[t++]));break;default:throw Error("Cannot deserialize argument.")}return{args:i,offset:t}}let y=(e,t,r,n,s)=>{const o=s.executorsAllowed.includes(9);return{execute(r,s,i){const a=e.get(r[s+1]),l=r[s+2],{offset:u,args:c}=x(r,s+3,1,e,t,n);s=c[0];const{offset:d,args:h}=x(r,u,l,e,t,n);return o&&i&&(v(s,a)?s[a]=h[0]:s[a](...h)),d}}};function v(e,t){if(!e)throw Error(`Property ${t} does not exist on ${e}.`);let r=Object.getOwnPropertyDescriptor(e,t);return void 0!==r?"set"in r:v(Object.getPrototypeOf(e),t)}let b=(e,t,r,n,s)=>{const o=s.executorsAllowed.includes(10);if(!n)throw Error("objectContext is not defined.");return{execute(r,s,i){const a=e.get(r[s+1]),l=r[s+2],u=r[s+3],{offset:c,args:d}=x(r,s+4,1,e,t,n);s=d[0];const{offset:h,args:g}=x(r,c,u,e,t,n);return o&&i&&"new"!==a&&n.store(l,s[a](...g)),h}}},k=(e,t,r,n,s)=>{const o=s.executorsAllowed.includes(11);return{execute:(e,n,s)=>(o&&s&&(s=t.getNode(e[n+1]))&&self.createImageBitmap(s).then((t=>{r.messageToWorker({12:10,73:e[n+2],38:t},[t])})),n+3)}},N=(e,t,r,n,s)=>{const o=s.executorsAllowed.includes(12);return{execute(t,n,i){if(o&&i){i=t[n+1];var a=t[n+2],l=t[n+3];const o=t[n+4];if(t=0<=l?e.get(l):"",l=0<=o?e.get(o):null,1===i)((e,t)=>{s.sanitizer&&2===e&&s.sanitizer.getStorage(e,t).then((n=>{r.messageToWorker({12:11,74:t,75:e,21:n})}))})(a,t);else if(2===i)if(i=a,a=t,t=l,s.sanitizer)s.sanitizer.setStorage(i,a,t);else{let e;if(0===i?e=window.localStorage:1===i&&(e=window.sessionStorage),e)if(null==a){if(null!=t)throw Error("Unexpected storage operation.");e.clear()}else null==t?e.removeItem(a):e.setItem(a,t)}}return n+5}}},C=0,A={};let O=(e,t,r,n,s)=>{const o=s.executorsAllowed.includes(13);return{execute(t,r){if(o){const n=t[r+1],s=t[r+2];t=t[r+3],t=e.hasIndex(t)?JSON.parse(e.get(t)):void 0,1===n?A[s].resolve(t):A[s].reject(t),delete A[s]}return r+4}}},E=(e,t,r,n,s)=>{const o=s.executorsAllowed.includes(14);return{execute:(e,r,n)=>(o&&n&&(e=t.getNode(e[r+1]))&&e.scrollIntoView(),r+2)}};class M{constructor(t,r,n,s,o){this.nodeContext=this.stringContext=void 0,this.mutationQueue=[],this.pendingMutations=!1,this.executors=this.sanitizer=this.mutationPumpFunction=void 0,this.syncFlush=(e=!0)=>{let t=[];return this.mutationQueue.forEach((r=>{let n=r.length,s=0;for(;s<n;){let n=r[s];var o;if(!(o=e)){e:switch(n){case 4:case 5:case 6:case 7:case 12:case 8:case 13:o=!1;break e;default:o=!0}o=!o}o||t.push(n),s=this.executors[n].execute(r,s,o)}})),this.mutationQueue=[],this.pendingMutations=!1,t},this.stringContext=t,this.nodeContext=r,this.sanitizer=s.sanitizer,this.mutationPumpFunction=s.mutationPump,r=f.apply(null,t=[t,r,n,o,s]),this.executors={2:d.apply(null,t),0:h.apply(null,t),1:g.apply(null,t),3:m.apply(null,t),4:u.apply(null,t),5:c.apply(null,t),6:r,7:r,8:e.apply(null,t),9:y.apply(null,t),10:b.apply(null,t),11:k.apply(null,t),12:N.apply(null,t),13:O.apply(null,t),14:E.apply(null,t)}}mutate(e,t,r,n){this.stringContext.storeValues(r),this.nodeContext.createNodes(t,this.sanitizer),this.mutationQueue=this.mutationQueue.concat(n),this.pendingMutations||(this.pendingMutations=!0,this.mutationPumpFunction(this.syncFlush,e))}}class P{constructor(){this.strings=[]}get(e){return this.strings[e]||""}hasIndex(e){return void 0!==this.strings[e]}store(e){this.strings.push(e)}storeValues(e){e.forEach((e=>this.store(e)))}}let T=[8,3];function W(e,t,r,n){var s=[].slice.call(e.childNodes).filter(r);return s={7:e._index_,11:0,0:e.nodeType,1:t(e.localName||e.nodeName),4:s.map((e=>W(e,t,r,n))),2:[].map.call(e.attributes||[],(e=>[t(e.namespaceURI||"null"),t(e.name),t(e.value)]))},null!=e.namespaceURI&&(s[6]=t(e.namespaceURI)),T.includes(e.nodeType)&&null!==e.textContent&&(s[5]=t(e.textContent)),o(n,e),i(n,e),s}function _(){return _=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_.apply(this,arguments)}class L{constructor(e,t){this.readyPromiseResolve=this.iframe=this.readyPromise=this.onmessageerror=this.onmessage=this.onerror=this.url=void 0,this.url=e,this.iframe=window.document.createElement("iframe"),this.iframe.setAttribute("sandbox","allow-scripts"),this.iframe.setAttribute("style","display:none"),this.iframe.setAttribute("src",t),this.url=e,this.readyPromise=new Promise((e=>{this.readyPromiseResolve=e})),this.setupInit(),this.proxyFromWorker(),window.document.body.appendChild(this.iframe)}setupInit(){let e=t=>{t.source==this.iframe.contentWindow&&fetch(this.url.toString()).then((e=>e.text())).then((r=>{const n=t.data;"iframe-ready"==n.type?this.iframe.contentWindow.postMessage({type:"init-worker",code:r},"*"):"worker-ready"===n.type&&(this.readyPromiseResolve(),window.removeEventListener("message",e))}))};window.addEventListener("message",e)}proxyFromWorker(){window.addEventListener("message",(e=>{if(e.source==this.iframe.contentWindow){var{type:t,message:r}=e.data;"onmessage"==t&&this.onmessage?this.onmessage(_({},e,{data:r})):"onerror"===t&&this.onerror?this.onerror(r):"onmessageerror"===t&&this.onmessageerror&&this.onmessageerror(_({},e,{data:r}))}}))}postMessage(e,t){let r={type:"postMessage",message:e};this.readyPromise.then((()=>{this.iframe.contentWindow.postMessage(r,"*",t)}))}terminate(){this.iframe.contentWindow.postMessage({type:"terminate"},"*"),this.iframe.remove()}}class S{constructor(e,t,r,n,s){this[55]=void 0,this.nodeContext=t,this.config=s;let{skeleton:o,strings:i}=function(e,t,r){t=t.hydrateFilter||(()=>!0);let n=[],s=new Map;return{skeleton:W(e,(e=>{if(s.has(e))return s.get(e);const t=n.length;return s.set(e,t),n.push(e),t}),t,r),strings:n}}(e,s,this);t=[];let a=[],l=U("localStorage"),u=U("sessionStorage");for(let r in e.style)t.push(r);for(let t in e)t.startsWith("on")&&a.push(t);r=`'use strict';(function(){${r}self['window']=self;var workerDOM=WorkerThread.workerDOM;WorkerThread.hydrate(workerDOM.document,${JSON.stringify(i)},${JSON.stringify(o)},${JSON.stringify(t)},${JSON.stringify(a)},[${window.innerWidth},${window.innerHeight}],${JSON.stringify(l)},${JSON.stringify(u)});workerDOM.document[59](this);Object.assign(self,workerDOM);}).call(self);${n}//# sourceURL=${encodeURI(s.authorURL)}`,this[55]=s.sandbox?new L(URL.createObjectURL(new Blob([r])),s.sandbox.iframeUrl):new Worker(URL.createObjectURL(new Blob([r]))),s.onCreateWorker&&s.onCreateWorker(e,i,o,t)}ready(){return this.worker.readyPromise||Promise.resolve()}get worker(){return this[55]}messageToWorker(e,t){this.config.onSendMessage&&this.config.onSendMessage(e),this.worker.postMessage(e,t||[])}}function U(e,t){try{return t?{storage:t.getStorage("localStorage"==e?0:1),errorMsg:null}:{storage:window[e],errorMsg:null}}catch(e){return{errorMsg:e.message,storage:null}}}class R{constructor(){this.objects=void 0,this.objects=new Map}store(e,t){this.objects.set(e,t)}get(e){let t=this.objects.get(e);if(t)return t;throw Error("Object with id ("+e+") does not exist.")}}class j{constructor(e,t){this.workerContext_=e,this.config=t}callFunction(e,...t){if(!this.config.executorsAllowed.includes(13))throw Error(`[worker-dom]: Error calling ${e}. You must enable the FUNCTION_CALL executor within the config.`);let{promise:r,index:n}=function(){let e,t,r=new Promise(((r,n)=>{e=r,t=n}));C>=Number.MAX_VALUE&&(C=0);let n=C++;return A[n]={promise:r,resolve:e,reject:t},{promise:r,index:n}}();return e={12:12,77:e,78:JSON.stringify(t),7:n},this.workerContext_.messageToWorker(e),r}set onerror(e){this.workerContext_.worker.onerror=e}terminate(){this.workerContext_.worker.terminate()}}let z=[3,2];function F(e,r,s){let o=new P,i=new R,a=new n(o,r),l=function(e){return Object.assign({},{mutationPump:requestAnimationFrame.bind(null),executorsAllowed:t},e)}(s);return e.then((([e,t])=>{if(e&&t&&s.authorURL){let n=new S(r,a,e,t,l),u=new M(o,a,n,l,i);return n.worker.onmessage=e=>{let{data:t}=e;z.includes(t[12])&&(u.mutate(t[54],t[37],t[41],new Uint16Array(t[36])),s.onReceiveMessage)&&s.onReceiveMessage(e)},n.ready().then((()=>new j(n,l)))}return null}))}let $=e=>null===e.parentNode||(e=(e.parentNode.localName||e.parentNode.nodeName).toLowerCase(),!/amp-/.test(e)||"amp-script"===e);function I(e,t,r){return r.hydrateFilter=$,F(t,e,r)}function D(e,t,r,n,s){let o=e.getAttribute("src");return o?function(e,t){return F(Promise.all([fetch(t.domURL).then((e=>e.text())),fetch(t.authorURL).then((e=>e.text()))]),e,t)}(e,{domURL:t,authorURL:o,longTask:r,hydrateFilter:$,sanitizer:n,sandbox:s}):Promise.resolve(null)}export{I as upgrade,D as upgradeElement};
//# sourceMappingURL=main.mjs.map
